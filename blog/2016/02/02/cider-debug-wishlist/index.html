<!DOCTYPE html>

<html><head><link href="http://pro.grammati.ca//blog/2016/02/02/cider-debug-wishlist/index.html" rel="canonical" /><meta content="True" name="HandheldFriendly" /><meta content="320" name="MobileOptimized" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta charset="utf-8" /><title>pro.grammati.ca</title><link href="/css/32ca7f0b6575/theme.css" rel="stylesheet" /><link href="/css/d4de3943cb2d/zenburn-custom.css" rel="stylesheet" /><link href="//fonts.googleapis.com/css?family=Cardo|Limelight" rel="stylesheet" type="text/css" /></head><body><header role="banner"><hgroup><h1><a href="/">pro.grammati.ca</a></h1></hgroup></header><nav role="navigation"><ul class="main-navigation"><li><a href="/blog/">Blog</a></li><li><a href="/atom.xml">Feed</a></li><li><a href="/about/">About</a></li></ul></nav><div id="main"><div id="content"><article class="entry" role="article"><header><h1 class="entry-title">Cider Debug Wishlist</h1><p class="meta"><time datetime="2016-02-02T00:00:00.000Z">2016-02-02</time></p></header><div class="body entry-content"><h2>Step In</h2><p>When stepping through code in the debugger, you can only step through functions that you have explicitly instrumented beforehand.</p><p>This is still, by far, the biggest reason that I have to attach Intellij and debug from there.</p><p>I'm not sure what the interface should be - hopefully something better than what edebug does, which is a bit awkward.</p><h2>Eval</h2><p>While stopped in the debugger, you can press <code>e</code> for <code>eval</code> (although it's not documented), but the resulting value is shown in an overlay, as if it was the value of the last expression.</p><p>You can work around this by evaluating <code>(prn thing)</code> or <code>(pprint thing)</code>, but it might be nice to have an <code>eval-and-pprint</code> command.</p><h2>Overlays</h2><p>Overlays are used to show values. (TODO: rant about overlays). I would often rather have the values pretty-printed into a dedicated buffer, so that I can search, copy, yank, etc.</p><h2>Conditional Breakpoints</h2><p>I want conditional breakpoints!</p><p>Strawman:</p><pre><code class="codehilite"><span></span><span class="o">#</span><span class="nv">break</span> <span class="o">^</span><span class="p">{</span><span class="ss">:bp/condition</span> <span class="p">(</span><span class="nb">some </span><span class="nv">expression</span><span class="p">)}</span> <span class="p">(</span><span class="nf">foo</span> <span class="nv">bar</span> <span class="p">(</span><span class="nf">baz</span><span class="p">))</span>
</code></pre><p>I'm pretty sure that a reader literal only gets to operate on the single form that follows it, but I think attaching the condition as read-time metadata to the form would work.</p><p>Could also add a condition when instumenting a defn, perhaps with <code>C-u C-u C-M-x</code>, then prompting for a the condition expression, which would be an expression of the arguments.</p><h2>Breakpoints List</h2><p>You can show a list of instumented functions, but it's very spartan. Should be able to jump to the function, uninstrument, etc.</p><p>It would also be nice to integrate this with the cider namespace browser (which itself could use some vast improvements!).</p><h2>Stacktrace</h2><p>There is now an <code>s</code> command to show the current stacktrace. Yay!</p><p>It might be nice to highlight stack-frames that are instrumented, and to instrument or uninstrument functions directly from the stacktrace buffer.</p><p>The reason for this is that sometimes I am debugging and can see that the parameters passed to the instrumented function are not what I expected. I will want to re-run whatever I'm doing with some functions higher in the stack instrumented so I can figure out where things went wrong.</p><h2>Inspector</h2><p>The cider inspector is used to show locals while stopped in the debugger.</p><p>Expanding maps is tedious. It should expand maps and sequeneces inline, indented. More of a tree-like view.</p><p>I also want it to live-update as I step, and retain its expansion-state whenever possible.</p><h2>Break on Exceptions</h2><p>Another thing that I currently turn to Intellij for is "Break on Exception". I would love it if cider could do this.</p><p>I'm not quite sure how cider could implement this, given its approach of intrumenting functions one-at-a-time.</p><p>One option is to have an option for mass-instrumenation of functions, by walking through loaded namespaces. This could be combined with an option to instrument code in such a way that it stops in the debugger at the point where an exception is thrown. As in Intellij, you would probably want to break conditionally, based on the specific exception class.</p><p>Another, perhaps more ambitious option would be to also integrate an entirely different debugger, based on JPDA. There may some code to be scavenged from the old emacs clojure debugger project, which I can't quite remember the name of right now (Hugo Duncan made it).</p><h2>Thread</h2><p>I want multithreaded debugging.</p><p>Imagine being able to step through two functions, executing in parallel, in side-by-side emacs windows. You could play with various ways of manually interleaving execution orders to reveal threading bugs (yes, those do happen in clojure!), race conditions, etc.</p><p>At the moment, I don't think this works well, if at all, although I need to do some experiments to see how far off we are. There certainly appear to be some bookkeeping vars in cider-nrepl's debug namespace that are not multithread-aware.</p><h2>Macroexpansion</h2><p>It would be pretty cool to step through the macroexpanded version of a piece of code, expanded inline.</p><h2>Finding Your Place</h2><p>At the moment, it's easy to lose your debug session.</p><p>Sometimes while stopped at a breakpoint, I start meta-dotting my way around the code, reading some other functions, etc. Eventually, I want to continue my debugging session, but I can't remember which function or even which namespace the debugger is stopped in. I need a way to jump back to the code that I'm currently stopped in.</p><h2>Read Only</h2><p>I would prefer if files were always read-only while debugging. The fact that you can type any character you like except for <code>n</code>, <code>e</code>, etc. (the debugger commands) is just weird.</p><p>Also, if I'm pounding on <code>n</code> in rapid succession and hit a function that takes some time (eg: a database call), then I accidentally start typing n's into the code.</p></div></article></div></div><footer role="contentinfo"><p>Copyright Â© 2020 - Chris Perkins</p></footer></body></html>